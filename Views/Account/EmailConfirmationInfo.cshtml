@{
    ViewData["Title"] = "Email Confirmation - DriveLuxe";
    var confirmationUrl = TempData["EmailConfirmationUrl"] as string;
    var devMode = TempData["DevMode"] as bool? ?? false;
}

@section Styles {
<style>
    :root {
        --primary: #135bec;
        --background-light: #f6f6f8;
    }

    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background: var(--background-light);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .confirmation-card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 600px;
    }
    
    /* Dark mode support */
    [data-theme="dark"] body {
        background: var(--bg-primary, #030712) !important;
        color: var(--text-primary, #f9fafb) !important;
    }
    
    [data-theme="dark"] h2:not(.card h2),
    [data-theme="dark"] h5:not(.card h5),
    [data-theme="dark"] p:not(.card p) {
        color: var(--text-primary, #f9fafb) !important;
    }
    
    /* CRITICAL: White cards in dark mode need dark text */
    [data-theme="dark"] .card,
    [data-theme="dark"] .confirmation-card {
        background: white !important;
        color: #1f2937 !important;
        border-color: #e5e7eb !important;
    }
    
    [data-theme="dark"] .card *,
    [data-theme="dark"] .confirmation-card * {
        color: #1f2937 !important;
    }
    
    [data-theme="dark"] .card .text-muted {
        color: #6b7280 !important;
    }
    
    [data-theme="dark"] .confirmation-url {
        background: #f9fafb !important;
        color: #1f2937 !important;
        border-color: #e5e7eb !important;
    }
    
    /* Keep colored sections white */
    [data-theme="dark"] .email-icon,
    [data-theme="dark"] .email-icon * {
        color: white !important;
    }

    .email-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--primary), #667eea);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .confirmation-url {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        padding: 1rem;
        word-break: break-all;
        font-family: monospace;
        font-size: 0.875rem;
    }
</style>
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="confirmation-card card">
                <div class="card-body p-5 text-center">
                    <div class="email-icon">
                        <span class="material-symbols-outlined text-white" style="font-size: 3rem;">mail</span>
                    </div>
                    
                    <h2 class="fw-bold mb-3">Check Your Email</h2>
                    <p class="text-muted mb-4">We've sent a confirmation email to your address. Please check your inbox (and spam folder) and click the confirmation link.</p>

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-warning text-start mt-4">
                            <span class="material-symbols-outlined me-2" style="vertical-align: middle;">warning</span>
                            @TempData["ErrorMessage"]
                        </div>
                    }

                    @if (TempData["InfoMessage"] != null)
                    {
                        <div class="alert alert-info text-start mt-4">
                            <span class="material-symbols-outlined me-2" style="vertical-align: middle;">info</span>
                            @TempData["InfoMessage"]
                        </div>
                    }

                    @if (devMode && !string.IsNullOrEmpty(confirmationUrl))
                    {
                        <div class="alert alert-info text-start mt-4">
                            <h5 class="fw-bold mb-3">
                                <span class="material-symbols-outlined me-2" style="vertical-align: middle;">code</span>
                                @(TempData["ErrorMessage"] != null ? "Email Confirmation Link" : "Development Mode - Email Confirmation Link")
                            </h5>
                            <p class="mb-2"><strong>Note:</strong> Email service is not configured. The email has been saved to a file in the <code>wwwroot/emails</code> folder, and here's your direct confirmation link:</p>
                            <div class="confirmation-url mb-3">
                                @confirmationUrl
                            </div>
                            <a href="@confirmationUrl" class="btn btn-primary btn-lg w-100 mb-2">
                                <span class="material-symbols-outlined me-2" style="font-size: 1rem; vertical-align: middle;">link</span>
                                Click Here to Confirm Email
                            </a>
                            <p class="text-muted small mt-3 mb-0">To enable email sending, configure SMTP settings in <code>appsettings.json</code>. Check <code>wwwroot/emails</code> folder for saved email files.</p>
                        </div>
                    }
                    else if (!string.IsNullOrEmpty(confirmationUrl))
                    {
                        <div class="alert alert-info text-start mt-4">
                            <h5 class="fw-bold mb-3">
                                <span class="material-symbols-outlined me-2" style="vertical-align: middle;">mail</span>
                                Email Confirmation Link
                            </h5>
                            <p class="mb-2"><strong>Direct confirmation link:</strong></p>
                            <div class="confirmation-url mb-3">
                                @confirmationUrl
                            </div>
                            <a href="@confirmationUrl" class="btn btn-primary btn-lg w-100 mb-2">
                                <span class="material-symbols-outlined me-2" style="font-size: 1rem; vertical-align: middle;">link</span>
                                Click Here to Confirm Email
                            </a>
                        </div>
                    }

                    <div class="mt-4">
                        <a asp-action="Login" class="btn btn-outline-primary">
                            <span class="material-symbols-outlined me-2" style="font-size: 1rem; vertical-align: middle;">arrow_back</span>
                            Back to Login
                        </a>
                        <a href="javascript:location.reload()" class="btn btn-primary ms-2">
                            <span class="material-symbols-outlined me-2" style="font-size: 1rem; vertical-align: middle;">refresh</span>
                            Resend Email
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

